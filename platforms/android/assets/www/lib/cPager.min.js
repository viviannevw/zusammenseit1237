/* cPager 0.4.1 */
function cPager(t){"use strict";function e(){(0==--n||n<0)&&(a._opt.onReady&&"function"==typeof a._opt.onReady&&(console.log("cPager - onReady"),a._opt.onReady()),a._lastopen?(s&&console.log("cPager - switch loaded: to last open",a._lastopen),a.switch(a._lastopen)):a._opt.start&&a._opt.start.page&&(s&&console.log("cPager - switch loaded: to start",a._opt.start),a.switch(a._opt.start.page,a._opt.start.task,a._opt.start.content,a._opt.start.param)))}this._page,this._open=0,this._lastopen=0,this._history=[],this._pageClass="",this._bodyClass="",this.animate=!1,this._opt={debug:!1,container:"page",handler:"pageBtn",handlerOff:"pageBtnOff",tmpl:[],tmplPath:"tmpl",ctrl:[],ctrlPath:"tasks",tasks:[],start:{page:!1,task:!1,content:!1,param:{history:!0}},animate:{timing:!1,direction:"left",duration:2},onReady:!1};var a=this;this._opt=this._h.deepExtend(this._opt,t);var s=this._opt.debug,n=this._opt.ctrl.length+ +this._opt.tmpl.length||0;if(this._page=document.getElementById(this._opt.container),!this._page)throw new Error("missing main container #"+this._opt.container);if(this._pageClass=this._page.className||"",this._bodyClass=document.body.className||"",s&&console.log("cPager - initialize"),this._opt.ctrl)for(var i in this._opt.ctrl)this._opt.ctrl.hasOwnProperty(i)&&this._h.loadScript(this._opt.ctrlPath+"/"+this._opt.ctrl[i]+".js",function(t){s&&console.log("cPager - load script: "+t),e()});return this.ajaxCache={},this._opt.tmpl.length>0&&this._h.cache(this,this._opt.tmpl,function(t){s&&console.log("cPager - cache page: "+t),e()}),n&&0!=n||e(),this}cPager.prototype.param=function(t){return this._opt=this._h.deepExtend(this._opt,t),!1},cPager.prototype.switch=function(t,e,a,s){var n=null;if(s&&s.event&&(n=s.event),"back"==e){var i=parseInt(a)+1||2,o=this.getHistory(),r=o[o.length-i];if(!r)return!1;if(!r.id)return!1;n=n||r.param.event,t=r.id,e=r.task,a=r.content,s=s||r.param,this.removeHistory(i)}return s||(s={}),this.switch.task=this._h.getTask(n,e,a,t,this,s),!(e&&!this.switch.task)&&(t?this._h.loadPage(this,"./"+this._opt.tmplPath+"/"+t+".tpl",t,e,a,s):this.switch.task&&"function"==typeof this.switch.task&&this.switch.task(),this)},cPager.prototype.events=function(){for(var t=this,e=document.getElementsByClassName(this._opt.handler),a=0;a<e.length;a++)e[a].style.curser="pointer",e[a].onclick||(e[a].onclick=function(e){if(t._opt.handlerOff&&this.classList.contains(t._opt.handlerOff))return!1;if(t.animate)return!1;var a=this.getAttribute("data-page"),s=this.getAttribute("data-task"),n=this.getAttribute("data-content"),i=this.getAttribute("data-container")||!1,o=this.getAttribute("data-animate")||t._opt.animate.timing,r=this.getAttribute("data-duration")||!1,c=this.getAttribute("data-direction")||!1,h=this.getAttribute("data-force")||!1,p=this.getAttribute("data-history")||!0;if(a||s){if(t._open==a&&!h)return!1;var l={event:e,history:p,animate:o,duration:r,direction:c,container:i||!1};t.switch(a,s,n,l)}});return!0},cPager.prototype.getHistory=function(){return!!this._history&&this._history},cPager.prototype.removeHistory=function(t){return t&&!isNaN(t)&&this._history.length>0?this._history=this._history.slice(0,this._history.length-t):this._history=[],!0},cPager.prototype.addHistory=function(t,e,a,s){var n={id:t,task:e,content:a,param:s};return this._history.push(n),!0},cPager.prototype.ctrl=function(t,e){if(!t||"string"!=typeof t||!e||"object"!=typeof e)return!1;this._opt.tasks[t]&&"object"==typeof this._opt.tasks[t]||(this._opt.tasks[t]={});for(var a in e)e.hasOwnProperty(a)&&(this._opt.tasks[t][a]=e[a]);return!0},cPager.prototype._h={deepExtend:function(t){t=t||{};for(var e=1;e<arguments.length;e++){var a=arguments[e];if(a)for(var s in a)a.hasOwnProperty(s)&&("object"==typeof a[s]?t[s]=this.deepExtend(t[s],a[s]):t[s]=a[s])}return t},getTask:function(t,e,a,s,n,i){if(n._opt.tasks&&e){var o=e.split(".");if(o.length>0){var r=!1,c=!1;return o[0]&&o[1]&&n._opt.tasks[o[0]]&&n._opt.tasks[o[0]][o[1]]?(r=n._opt.tasks[o[0]][o[1]],c=n._opt.tasks[o[0]]):o[0]&&n._opt.tasks[o[0]]&&(r=n._opt.tasks[o[0]],c=n._opt.tasks),r&&"function"==typeof r?r({page:s,content:a,event:t,node:n._page,scope:c}):(console.error("cPager Error: missing task function",e),!1)}}return!1},successPage:function(t,e,a,s,n,i){t.switch.task&&"function"==typeof t.switch.task&&(t.switch.afterAnimate=t.switch.task(i||t._page)),n.animate||t.events(),n&&"false"!=String(n.history)&&t.addHistory(e,a,s,n),n&&n.onReady&&"function"==typeof n.onReady&&n.onReady()},successAnimate:function(t,e,a,s,n,i){t.animate=!1,t.switch.task&&t.switch.afterAnimate&&"function"==typeof t.switch.afterAnimate&&t.switch.afterAnimate(),t.events()},appendPage:function(t,e,a,s,n,i){var o=n._page;if(i&&i.container&&!(o=document.getElementById(i.container)))throw new Error("missing container #"+this._opt.container);var r=e.replace(/\//gi,"-");document.body.className=n._bodyClass+" "||"",document.body.className+=" cPager-body-"+r,i&&i.animate?this.animatePage(n,e,a,s,i,o,r,t):(o.innerHTML=t,o.className=n._pageClass+" "||"",o.className+="cPager-"+r,n._lastopen=n._open,n._open=e,this.successPage(n,e,a,s,i,o))},animatePage:function(t,e,a,s,n,i,o,r){t.animate=!0,n.duration||(n.duration=t._opt.animate.duration),n.direction||(n.direction=t._opt.animate.direction),i.id=t._opt.container+"Temp",i.style.width=i.clientWidth+"px",i.style.height=i.clientHeight+"px",i.style.position="fixed",i.style.transform="translate3d(0,0,0)",i.style.transition="transform "+n.duration+"s "+n.animate;var c=document.createElement("div");switch(c.id=t._opt.container,c.className=t._pageClass+" "||"",c.className+="cPager-"+o,c.innerHTML=r,c.style.position="fixed",c.style.width=i.clientWidth+"px",c.style.height=i.clientHeight+"px",n.direction){case"left":default:c.style.transform="translate3d("+i.style.width+",0,0)";break;case"right":c.style.transform="translate3d(-"+i.style.width+",0,0)";break;case"top":c.style.transform="translate3d(0,"+i.style.height+",0)";break;case"bottom":c.style.transform="translate3d(0,-"+i.style.height+",0)"}c.style.transition="transform "+n.duration+"s "+n.animate,document.body.insertBefore(c,i.nextSibling),setTimeout(function(){switch(n.direction){case"left":default:i.style.transform="translate3d(-"+i.style.width+",0,0)";break;case"right":i.style.transform="translate3d("+i.style.width+",0,0)";break;case"top":i.style.transform="translate3d(0,-"+i.style.height+",0)";break;case"bottom":i.style.transform="translate3d(0,"+i.style.height+",0)"}c.style.transform="translate3d(0,0,0)",t._lastopen=t._open,t._open=e,t._page=c,t._h.successPage(t,e,a,s,n,c)},100),setTimeout(function(){i.remove(),t._h.successAnimate(t,e,a,s,n,c),i.style.transition="",c.style.transition="",document.body.className=t._bodyClass+" "||"",document.body.className+="cPager-body-"+o},1e3*n.duration+100)},loadPage:function(t,e,a,s,n,i){var o=this;t.ajaxCache[e]?o.appendPage(t.ajaxCache[e],a,s,n,t,i):this.sendRequest(e,function(r){t.ajaxCache[e]=r,o.appendPage(r,a,s,n,t,i)})},cache:function(t,e,a){for(var s=0;s<e.length;s++){var n="./"+t._opt.tmplPath+"/"+e[s]+".tpl";t._opt.debug&&(n=n+"?t="+Math.random(1,100)),this.sendRequest(n,function(e,s){t.ajaxCache[s]=e,a&&"function"==typeof a&&a(s)})}},sendRequest:function(t,e,a){if(window.jQuery)jQuery.ajax({url:t,dataType:"html",cache:!1}).done(function(a){e(a,t)}).fail(function(t){console.log("cPager - jQuery ajax error",t)});else{var s=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],n=function(){for(var t=!1,e=0;e<s.length;e++){try{t=s[e]()}catch(t){continue}break}return t}();if(!n)return;var i=a?"POST":"GET";if(n.open(i,t,!0),n.setRequestHeader("User-Agent","XMLHTTP/1.0"),a&&n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){4==n.readyState&&(200!=n.status&&304!=n.status||e(n.responseText,t))},4==n.readyState)return;n.send(a)}},loadScript:function(t,e){var a=document.getElementsByTagName("head")[0],s=document.createElement("script");s.type="text/javascript",s.src=t,s.onreadystatechange=e,s.onload=function(){e&&"function"==typeof e&&e(t)},a.appendChild(s)}};